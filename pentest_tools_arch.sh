#!/bin/bash

# Functions

FLAG=$((0))

help_module () {
	# Help module

	echo " ____    _    ____ ___ ____   ____  _____ _   _ _____ _____ ____ _____"
	echo "| __ )  / \  / ___|_ _/ ___| |  _ \| ____| \ | |_   _| ____/ ___|_   _|"
	echo "|  _ \ / _ \ \___ \| | |     | |_) |  _| |  \| | | | |  _| \___ \ | |  "
	echo "| |_) / ___ \ ___) | | |___  |  __/| |___| |\  | | | | |___ ___) || |  "
	echo "|____/_/   \_\____/___\____| |_|   |_____|_| \_| |_| |_____|____/ |_|  "
    echo
 	echo " _____ ___   ___  _     ____  "
	echo "|_   _/ _ \ / _ \| |   / ___| "
	echo "  | || | | | | | | |   \___ \ "
  	echo "  | || |_| | |_| | |___ ___) |"
  	echo "  |_| \___/ \___/|_____|____/ "
  	echo "                             Arch edition"
  	echo 
  	echo
  	echo "Usage:	./pentest_tools_arch [ARGS]"
  	echo "		  invoking the command without [ARGS] installs the essentials."
  	echo "		  Will be prompted if want optional tools"
  	echo "[ARGS]"
  	echo "  --help	  Displays this help message"
  	echo "  --setoolkit 	  Installs setoolkit only"
  	echo "  --metasploit    Installs metasploit framework only"
  	echo "  --evillimiter   Installs evillimiter (https://github.com/bitbrute/evillimiter)"
  	echo "  --wifi   	  Installs the wireless tools"
  	echo "  --wordlists     Installs the wordlists in the /opt directory"
  	echo
  	echo "For more information about the tools being installed, check out the github page:"
  	echo "		  https://github.com/0xcabrex/Pentest-tools "
  	echo 
}

install_msfconsole () {
	# Installing metasploit:

	if [ $(which msfconsole 2>/dev/null) -e '/usr/bin/msfconsole' ]
	then
		echo
		echo
		echo -e "\e[1;33m-[WARNING]\e[0m Metasploit already present.. Skipping."
	else
		echo
		echo
		echo -e "\e[1;32m+[OK]\e[0m Installing metasploit module.."
		echo -e "\e[1;32m+[OK]\e[0m Installing dependencies.."
		yes | sudo pacman -S postgresql-libs ruby ruby-bundler ruby-pg inetutils
		mkdir -p /dev/shm/metasploit
		mkdir -p /dev/shm/aur_tmp
		cd /dev/shm/aur_tmp
		git clone https://aur.archlinux.org/metasploit-git.git
		echo "Done cloning, changing directory and building package"
		sleep 3
		cd metasploit-git
		yes | makepkg -sri
		rm -r /dev/shm/metasploit
		echo -e "\e[1;32m+[OK]\e[0m Installed metasploit"
		FLAG=$(($FLAG + 1))
	fi
}

install_setoolkit () {
	# Installing SEToolkit:

	if [ $(which setoolkit) == '/usr/local/bin/setoolkit' ]
	then
		echo
		echo
		echo -e "\e[1;33m-[WARNING]\e[0m SEToolkit already present.. Skipping."
	else
		clear
		echo -e "\e[1;32m+[OK]\e[0m Installing setoolkit.."
		git clone https://github.com/trustedsec/social-engineer-toolkit.git /dev/shm/setoolkit
		if [ $(which python3) == 'usr/bin/python3' ]
		then 
			sudo python3 -m pip install -r /dev/shm/setoolkit/requirements.txt
			sudo python3 /dev/shm/setoolkit/setup.py
		else
			yes | sudo pacman -S python3 python-pip
			sudo python3 -m pip install -r /dev/shm/setoolkit/requirements.txt
			sudo python3 /dev/shm/setoolkit/setup.py
		fi
		sudo rm -r /dev/shm/setoolkit
		echo -e "\e[1;32m+[OK]\e[0m Installed setoolkit successfully"
		FLAG=$(($FLAG + 1))
	fi
}

install_evillimiter () {
	# Installing Evillimiter:

	if [ $(which evillimiter) -e '/usr/local/bin/evillimiter' ]
	then
		echo
		echo
		echo -e "\e[1;33m-[WARNING]\e[0m Evillimiter already present.. Skipping."
	else
		echo
		echo
		echo -e "\e[1;32m+[OK]\e[0m Installing Evillimiter.."
		git clone https://github.com/bitbrute/evillimiter.git /dev/shm/evillimiter
		if [ $(which python3) == '/usr/bin/python3' ]
		then
			sudo python3 /dev/shm/evillimiter/setup.py install
			sudo rm -r /dev/shm/evillimiter
		else
			sudo echo -e "\e[1;31m-[FATAL]\e[0m Python not found, installing.."
			yes | sudo pacman -S python3 python-pip
			sudo python3 /dev/shm/evillimiter/setup.py install
			sudo rm -r /dev/shm/evillimiter
		fi
		echo -e "\e[1;32m+[OK]\e[0m Installed Evillimiter successfully"
		FLAG=$(($FLAG + 1))
	fi
}

install_wifi_tools () {
	# Installing the Wifi tools:

	if [ $(which wireshark) == '/usr/bin/wireshark' -a $(which arp-scan) == '/usr/sbin/arp-scan' -a $(which macchanger) == '/usr/bin/macchanger' -a $(which kismet) == '/usr/bin/kismet' -a $(which speedtest-cli) == '/usr/bin/speedtest-cli' -a $(which aircrack-ng) == '/usr/bin/aircrack-ng' ]
	then
		echo
		echo
		echo -e "\e[1;33m-[WARNING]\e[0m wireshark, arp-scan, macchanger, kismet, speedtest-cli, aircrack-ng are all installed, Skipping"
	else
		echo
		echo
		echo -e "\e[1;32m+[OK]\e[0m Installing wireless tools.."
		echo
		yes | sudo pacman -S arp-scan macchanger kismet speedtest-cli aircrack-ng
		echo
		install_evillimiter
		echo
		# Installing wireshark using aur:
		echo -e "\e[1;32m+[OK]\e[0m Making aur_tmp directory.."
		mkdir -p /dev/shm/aur_tmp
		git clone https://aur.archlinux.org/wireshark-gtk2.git /dev/shm/aur_tmp
		cd wireshark-gtk2
		yes | sudo pacman -S libmaxminddb
		yes | makepkg -sri
		FLAG=$(($FLAG + 1))
	fi
}

cleanup () {
	# Autoclean and autoremove

	echo
	echo
	echo -e "\e[1;32m+[OK]\e[0m Cleaning up.."
	sleep 1
	echo
	yes | sudo pacman -Rscn $(sudo pacman -Qtdq) 2>/dev/null
	rm -rf /dev/shm/*

}

install_wordlists () {
	# Making common wordlist for gobuster in /opt/wordlist:

	echo
	echo
	if [ -d '/opt' ]
	then
		echo -e "\e[1;32m+[OK]\e[0m Getting common wordlists for gobuster.. "
		echo
		echo
		sudo mkdir -p /opt/wordlist
		sudo mkdir -p /opt/wordlist/dirb
		if [ -f "/opt/wordlist/dirb/big.txt" -a -f "/opt/wordlist/dirb/common.txt" -a -f "/opt/wordlist/dirb/small.txt" ]
		then
			echo "The wordlists have already been installed in the /opt/wordlist/dirb/ directory"
		else
			sudo wget https://raw.githubusercontent.com/v0re/dirb/master/wordlists/big.txt -O /opt/wordlist/dirb/big.txt
			sudo wget https://raw.githubusercontent.com/v0re/dirb/master/wordlists/common.txt -O /opt/wordlist/dirb/common.txt
			sudo wget https://raw.githubusercontent.com/v0re/dirb/master/wordlists/small.txt -O /opt/wordlist/dirb/small.txt
			FLAG=$(($FLAG + 1))
		fi

		# Downloading rockyou.txt.gz and extracting it:
		echo 
		echo
		echo -e "\e[1;32m+[OK]\e[0m Getting Rockyou.txt.."
		echo
		echo
		if [ -f "/opt/wordlist/rockyou.txt" ]
		then
			echo -e "Rockyou.txt already exists in /opt/wordlist/ directory"
		else
			if [ -f "/opt/wordlist/rockyou.txt.gz" ]
			then
				echo -e "Rockyou.txt.gz already exists in /opt/wordlist/ directory, not Downloading.."
			else
				sudo wget "https://github.com/praetorian-code/Hob0Rules/blob/master/wordlists/rockyou.txt.gz?raw=true" -O /opt/wordlist/rockyou.txt.gz
			fi
			sudo gunzip -c /opt/wordlist/rockyou.txt.gz | sudo tee  /opt/wordlist/rockyou.txt >/dev/null
			sudo rm /opt/wordlist/rockyou.txt.gz
			FLAG=$(($FLAG + 1))
		fi
	else
		echo -e "\e[1;31m-[FATAL]\e[0m /opt directory does not exist, please create it manually to install wordlists"
	fi	

}

# Program


# Breakpoint for reference

if [ $(cat /etc/issue | grep -ic "arch") -ge 1 ]
then
	if [ ! -f /usr/bin/which ]
	then
		sudo pacman -S base-devel
	fi

	if [ "$1" = '--help' ]
	then
		help_module
		exit

	elif [ "$1" = '--setoolkit' ]
	then
		if [ "$EUID" ==	 0 ]
		then
			help_module
	  		echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"		
	  		exit
		fi
		install_setoolkit

	elif [ "$1" = '--metasploit' ]
	then
		if [ "$EUID" == 0 ]
		then
			help_module
			echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"
	  		exit
		fi
		install_msfconsole

	elif [ "$1" = '--evillimiter' ]
	then
		if [ "$EUID" == 0 ]
		then
			help_module
			echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"
	  		exit
		fi
		install_evillimiter

	elif [ "$1" = '--wordlists' ]
	then
		if [ "$EUID" == 0 ]
		then
			help_module
			echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"
	  		exit
		fi
		install_wordlists		

	elif [ "$1" = '--wifi' ]
	then
		if [ "$EUID" == 0 ]
		then
			help_module
	  		echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"
	  		exit
		fi
		install_wifi_tools

	elif [ "$1" = '' ]
	then
		if [ "$EUID" == 0 ]
		then 
			help_module
			echo -e "\e[1;31m-[ERROR]\e[0m Running as root is not adviced, password will be asked when needed"
	  		exit
		fi

		read -p "Do you want to install all tools?(y/n/c): " ANSWER
		if [ $ANSWER == 'y' ]
		then
			echo
			echo
			echo -e "\e[1;32m+[OK]\e[0m Optional tools will be installed "
			echo -e "\e[1;32m+[OK]\e[0m commencing upgrade.."
			echo 
			echo
			sleep 1
			yes | sudo pacman -Syu
			#$(which terminator) == "/usr/bin/terminator" -a 
			if [ $(which arp-scan) == "/usr/bin/arp-scan" -a $(which wireshark) == "/usr/bin/wireshark" -a $(which macchanger) == "/usr/bin/macchanger" -a $(which speedtest-cli) == "/usr/bin/speedtest-cli" -a $(which hexedit) == "/usr/bin/hexedit" -a $(which objdump) == "/usr/bin/objdump" -a $(which java) == '/usr/bin/java' -a $(which proxychains) == '/usr/bin/proxychains' -a $(which aircrack-ng) == '/usr/bin/aircrack-ng' -a $(which kismet) == '/usr/bin/kismet' ]
			then
				echo -e "\e[1;33m+[WARNING]\e[0m arp-scan, wireshark, macchanger, speedtest-cli, hexedit, binutils-i586-linux-gnu, default-jdk, proxychains, aircrack-ng, kismet, are already installed"
			else
				echo -e "\e[1;32m+[OK]\e[0m Installing all tools.."
				sleep 1
				clear
				# echo -e "\e[1;32m+[OK]\e[0m Installing terminator..."
				# apt install terminator -y
				# clear
				echo -e "\e[1;32m+[OK]\e[0m Installing arp-scan..."
				yes | sudo pacman -S arp-scan
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing tor..."
				yes | sudo pacman -S tor
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing wireshark..."
				yes | sudo pacman -S wireshark
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing macchanger..."
				yes | sudo pacman -S macchanger
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing speedtest-cli..."
				yes | sudo pacman -S speedtest-cli
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing hexedit..."
				yes | sudo pacman -S hexedit
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing binutils-i586-linux-gnu..."
				yes | sudo pacman -S binutils
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing default-jdk..."
				yes | sudo pacman -S openjdk
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing proxychains..."
				yes | sudo pacman -S proxychains-ng
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing aircrack-ng..."
				yes | sudo pacman -S aircrack-ng
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing kismet..."
				yes | sudo pacman -S kismet
				
				install_msfconsole
				install_setoolkit
				install_evillimiter
				install_wordlists
				
				FLAG=$(($FLAG + 1))
			fi

		elif [ $ANSWER == 'n' ]
		then
			echo
			echo -e "\e[1;32m+[OK]\e[0m Optional tools will NOT be installed "
			echo -e "\e[1;32m+[OK]\e[0m commencing upgrade.."
			sleep 1
			echo
			echo
			yes | sudo pacman -Syu
			echo
			if [ $(which wget) == '/usr/bin/wget' -a $(which curl) == '/usr/bin/curl' -a $(which nmap) == '/usr/bin/nmap' -a $(which sqlmap) == '/usr/bin/sqlmap' -a $(which git) == '/usr/bin/git' -a $(which nikto) == '/usr/bin/nikto' -a $(which gobuster) == '/usr/bin/gobuster' -a $(which hydra) == '/usr/bin/hydra' ]
			then
				echo -e "\e[1;33m+[WARNING]\e[0m wget, curl, nmap, sqlmap, git, python3-pip, nikto, gobuster, hydra, have been already instaled"
			else
				echo -e "\e[1;32m+[OK]\e[0m Installing basic tools.."
				sleep 1
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing wget...."
				yes | sudo pacman -S wget
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing curl...."
				yes | sudo pacman -S curl
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing nmap...."
				yes | sudo pacman -S nmap
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing sqlmap...."
				yes | sudo pacman -S sqlmap
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing git...."
				yes | sudo pacman -S git
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing python3-pip...."
				yes | sudo pacman -S python-pip
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing nikto...."
				yes | sudo pacman -S nikto
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing gobuster...."
				mkdir -p /dev/shm/aur_tmp
				cd /dev/shm/aur_tmp
				git clone https://aur.archlinux.org/gobuster-git.git
				cd gobuster
				yes | makepkg -sri
				clear
				echo -e "\e[1;32m+[OK]\e[0m Installing hydra...."
				yes | sudo pacman -S hydra
				FLAG=$(($FLAG + 1))

				clear
				install_wordlists
			fi

		elif [ $ANSWER == 'c' ]
		then
			echo "OK"
			exit

		else
			echo -e "\e[1;31m-[ERROR]\e[0m Please enter y or n"
			exit
		fi
	else
		help_module
		echo -e "\e[1;31m-[ERROR]\e[0m Invalid argument $1"
		exit
	fi

else
	echo
	echo -e "\e[1;31m-[ERROR]\e[0m This script can only run on arch systems. Aborting"
fi

# Breakpoint for reference

if [ $FLAG == 0 ]
then
	echo
	echo
	echo -e "\e[1;33mNo changes were done to your system.\e[0m"
	echo
	exit
else
	cleanup	
	echo
	echo
	echo -e "\e[1;32mAll tools have been installed successfully!\e[0m"
	echo
	exit
fi
